<!DOCTYPE html>
<html>
<head>
    <title>Payment</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="container">
    <h2>Make Payment</h2>

    <form id="paymentForm">
        <input
                type="text"
                id="upi"
                placeholder="Enter UPI ID (e.g. abc@upi)"
                required />

        <input
                type="number"
                id="amount"
                placeholder="Enter Amount"
                required />

        <button type="submit">Pay Now</button>
    </form>

    <p id="message"></p>

    <div class="link">
        <a href="/dashboard">Back to Dashboard</a>
    </div>
</div>

<script>
    // üîê TOKEN CHECK
    const token = localStorage.getItem("token");

    if (!token) {
        alert("Please login first");
        window.location.href = "/login";
    }

    // üí∏ PAYMENT LOGIC
    document.getElementById("paymentForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        const upi = document.getElementById("upi").value;
        const amount = document.getElementById("amount").value;
        const message = document.getElementById("message");

        message.style.color = "black";
        message.innerText = "Processing payment...";

        try {
            const response = await fetch("/payment/initiate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify({
                    upiId: upi,
                    amount: amount
                })
            });

            if (!response.ok) {
                throw new Error("Payment failed");
            }

            const data = await response.json();
            console.log("Transaction response:", data);

            message.style.color = "green";
            message.innerText = "‚úÖ Payment Successful! Transaction ID: " + data.id;

            document.getElementById("upi").value = "";
            document.getElementById("amount").value = "";

            setTimeout(() => {
              message.innerText = "";
            }, 3000);


        } catch (err) {
            console.error(err);
            message.style.color = "red";
            message.innerText = "‚ùå Payment Failed. Please try again.";
        }
    });
</script>

</body>
</html>
